<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Estilo Prisma</title>
  <link rel="stylesheet" href="style.css">
</head>

  <div class="fondo-animado">
  <img src="icons/top.svg" class="icono flotante1" alt="Top">
  <img src="icons/corset.svg" class="icono flotante2" alt="Corset">
  <img src="icons/percha.svg" class="icono flotante3" alt="Percha">
</div>

  <body>

  <h1>Estilo Prisma</h1>

  <select id="filtroCategoria">
    <option value="Todas">Todas las categorías</option>
  </select>
  <button id="quitarFiltro">Quitar Filtro</button>

  <input type="file" id="archivoCSV" accept=".csv">

  <div id="productosContainer"></div>

  <script>
    let todosLosProductos = [];

    document.getElementById('archivoCSV').addEventListener('change', function (e) {
      const archivo = e.target.files[0];
      const lector = new FileReader();

      lector.onload = function (event) {
        const texto = event.target.result;
        const lineas = texto.trim().split('\n');
        const encabezados = lineas[0].split(',');

        const productos = lineas.slice(1).map(linea => {
          const datos = linea.split(',');
          const producto = {};
          encabezados.forEach((campo, i) => {
            producto[campo.trim()] = datos[i] ? datos[i].trim() : '';
          });
          return producto;
        });

        todosLosProductos = productos;
        cargarCategorias(productos);
        mostrarProductos(productos);
      };

      lector.readAsText(archivo);
    });

    function cargarCategorias(productos) {
      const filtro = document.getElementById('filtroCategoria');
      const categorias = [...new Set(productos.map(p => p['Categoría']).filter(Boolean))];

      filtro.innerHTML = `<option value="Todas">Todas las categorías</option>`;
      categorias.forEach(cat => {
        const opcion = document.createElement('option');
        opcion.value = cat;
        opcion.textContent = cat;
        filtro.appendChild(opcion);
      });
    }

    function mostrarProductos(productos) {
      const contenedor = document.getElementById('productosContainer');
      contenedor.innerHTML = '';

      productos.forEach(producto => {
        if (!producto.Enlace || !producto.Name || !producto.Precio) return;

        const div = document.createElement('div');
        div.className = 'producto';

        div.innerHTML = `
          <img src="${producto.Enlace}" alt="Producto">
          <h3>${producto.Name}</h3>
          <p class="precio">$${parseInt(producto.Precio).toLocaleString()}</p>
          <p class="categoria">${producto['Categoría']}</p>
        `;

        contenedor.appendChild(div);
      });
    }

    document.getElementById('filtroCategoria').addEventListener('change', function () {
      const categoriaSeleccionada = this.value;
      const filtrados = categoriaSeleccionada === 'Todas'
        ? todosLosProductos
        : todosLosProductos.filter(p => p['Categoría'] === categoriaSeleccionada);

      mostrarProductos(filtrados);
    });

    document.getElementById('quitarFiltro').addEventListener('click', function () {
      document.getElementById('filtroCategoria').value = 'Todas';
      mostrarProductos(todosLosProductos);
    });
  </script>

</body>
</html>
